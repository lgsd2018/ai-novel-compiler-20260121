# AI小说编译器 - 项目TODO清单

## P0 核心功能（必备）

### P0-1 项目管理模块
- [x] 实现IDE式文件树结构
- [x] 支持章节、角色、设定、大纲等文档类型的创建
- [x] 实现项目模板快速创建功能
- [x] 版本历史管理和回滚功能
- [x] 项目打开、保存功能

### P0-2 文本编辑器模块
- [x] Markdown语法支持和实时预览
- [x] 语法高亮（对话、叙述、注释）
- [x] 多标签页编辑功能
- [x] 自动保存和版本控制
- [x] 专注写作模式

### P0-3 AI辅助创作模块
- [x] 内容生成（根据提示生成章节）
- [x] 智能续写（基于上下文自动续写）
- [x] 内容优化（润色、扩写、重写）
- [x] 灵感激发（创作建议）
- [x] AI输出流式展示（后端支持）

### P0-4 大模型配置模块
- [x] 集成DeepSeek API
- [x] 自定义API端点配置
- [x] API密钥安全管理
- [x] 模型参数设置（temperature、top_p、max_tokens）
- [x] 使用统计和成本优化功能
- [x] 模型切换功能
- [x] 批量生成并比较结果

## P1 重要增强功能

### P1-1 可视化故事线图谱
- [x] 时间轴式布局设计
- [x] 节点代表关键事件
- [x] 拖拽调整事件顺序和时间位置
- [x] 分支管理（从决策点创建分支剧情）
- [x] 分支合并处理
- [x] 角色关系可视化展示
- [x] AI辅助布局优化

### P1-2 角色和世界观管理
- [x] 角色卡片系统（姓名、外貌、性格、背景等）
- [x] 关系图谱可视化
- [x] 世界观设定管理（时间、地点、规则）
- [x] 一致性检查机制

### P1-3 导出和发布模块
- [x] 多格式导出（PDF、EPUB、Word、HTML）
- [x] 自定义排版和样式设置
- [x] 一键发布到创作平台（基础框架）
- [x] 版权管理和水印功能

## P2 增值功能

### P2-1 实时协作编辑
- [x] 团队内项目共享和协作编辑
- [x] 精细化权限控制
- [x] 文档评论和审阅流程
- [x] 多人协作版本冲突解决（版本历史）

### P2-2 写作数据统计和分析
- [x] 字数统计
- [x] 写作时长统计
- [x] 创作进度跟踪
- [x] AI使用量记录
- [x] 数据可视化看板

### P2-3 收费系统和多租户功能
- [x] 后台可配置价格和套餐
- [x] 功能限制配置
- [x] 使用量计费（AI token计数、存储计量）
- [x] 企业管理员后台（租户管理）
- [x] 租户管理和数据隔离

## 额外功能

### 存储和通知
- [x] S3存储集成（项目文件、导出作品、角色头像）
- [x] 大文件上传和管理
- [x] 操作完成通知（作品导出完成、AI生成失败、一致性检查问题）

### 多模型支持
- [x] 多种大语言模型集成（支持自定义API）
- [x] 自动选择性价比最优模型（基于成本统计）

## 优化功能

### 用户体验优化
- [x] 前端AI流式展示（打字机效果）
- [x] 导出样式定制（可视化排版编辑器）
- [x] 封面设计器
- [x] 字体选择和页边距调整

### 平台集成
- [x] 起点中文网API集成（基础框架）
- [x] 晋江文学城API集成（基础框架）
- [x] 一键发布到多平台（UI完成）

## 平台发布完善

### 数据库和后端
- [x] 平台账号配置表设计
- [x] 发布任务和状态管理表
- [x] 起点中文网API认证实现
- [x] 起点中文网作品创建和更新
- [x] 起点中文网章节上传
- [x] 晋江文学城API认证实现
- [x] 晋江文学城作品创建和更新
- [x] 晋江文学城章节上传

### 前端功能
- [x] 平台账号配置管理界面
- [x] 发布任务创建和配置
- [x] 发布进度实时显示
- [x] 发布历史和日志查看

## 发布前预检查功能

### 后端实现
- [x] 章节完整性检查（缺失章节、顺序错误）
- [x] 字数限制检查（最小/最大字数）
- [x] 敏感词过滤检查
- [x] 格式规范检查（标题格式、内容格式）
- [x] 预检查API集成到发布流程

### 前端实现
- [x] 预检查结果显示界面
- [x] 问题列表和修复建议
- [x] 一键修复功能

## AI语音朗读功能

### 后端实现
- [x] TTS API集成（文本转语音）
- [x] 音频缓存机制
- [x] 支持多种语音选择
- [x] 语速和音调调节

### 前端实现
- [x] 语音播放器组件
- [x] 播放控制（播放/暂停/停止）
- [x] 进度条和时间显示
- [x] 集成到编辑器
- [x] 集成到预览界面

## 语音识别功能

### 后端实现
- [x] 语音识别API集成（Whisper/Azure/DeepSeek）
- [x] 音频文件上传和处理
- [x] 支持实时流式识别
- [x] 支持多语言识别

### 前端实现
- [x] 语音录制组件
- [x] 录制控制（开始/暂停/停止）
- [x] 实时波形显示
- [x] 识别结果实时显示
- [x] 集成到编辑器

## 异步发布任务队列
- [x] 安装和配置BullMQ
- [x] 创建发布任务队列
- [x] 实现任务处理器
- [x] 支持任务暂停/恢复/取消
- [x] 实时进度追踪
- [x] 前端任务状态显示示

## 敏感词库管理

- [x] 敏感词数据库表设计
- [x] 敏感诊CRUD API
- [x] 敏感词管理界面
- [x] 支持导入/导出
- [x] 分类管理
- [x] 正则表达式匹配

## 平台规则配置

- [x] 平台规则数据库表
- [x] 规则配置API
- [x] 规则管理界面
- [x] 规则版本管理
- [x] 自动更新机制

## 多模型选择

- [x] AI模型配置界面优化
- [x] 聊天框模型选择器
- [x] 模型切换功能
- [x] 模型参数实时调整

## 敏感词库管理完善

### 后端API
- [x] 敏感词CRUD API（创建、读取、更新、删除）
- [x] 批量操作API（批量删除、批量导入）
- [x] 分类筛选API
- [x] 导入导出API

### 前端界面
- [x] 敏感词列表页面
- [x] 添加/编辑敏感词对话框
- [x] 批量删除功能
- [x] 分类筛选和搜索
- [x] 导入CSV/JSON功能
- [x] 导出CSV/JSON功能
- [x] 分类管理功能

## Redis配置和任务监控

### Redis配置
- [x] 添加Redis环境变量配置
- [x] 配置Redis连接选项
- [x] 测试Redis连接
- [x] 添加Redis连接错误处理

### BullMQ完善
- [x] 更新queue.ts使用Redis配置
- [x] 实现任务状态更新
- [x] 实现任务进度追踪
- [x] 添加任务失败重试机制

### 任务监控仪表盘
- [x] 创建任务监控API
- [x] 实现任务列表查询
- [x] 实现任务统计数据
- [x] 创建任务监控页面
- [x] 实时任务状态显示
- [x] 任务操作（暂停/恢复/取消）
- [x] 任务日志查看

### 平台规则配置界面
- [x] 创建平台规则数据库辅助函数
- [x] 实现平台规则tRPC API
- [x] 创建平台规则配置页面
- [x] 支持字数限制配置
- [x] 支持标签数量配置
- [x] 支持分类要求配置
- [x] 支持章节标题规则配置
- [x] 支持敏感词检测规则配置
- [x] 规则版本管理
- [x] 规则导入导出功能

### 导航菜单优化
- [x] 在主导航菜单中添加"任务监控"链接
- [x] 优化导航菜单布局


## 实时流式语音识别

### 后端实现
- [x] 创建WebSocket服务器
- [x] 实现音频流接收和缓冲
- [x] 集成流式语音识别API
- [x] 实现实时识别结果推送
- [x] 错误处理和重连机制

### 前端实现
- [x] 实现WebSocket客户端连接
- [x] 实现实时音频采集和流式传输
- [x] 实时显示识别结果
- [x] 支持识别暂停和恢复
- [x] 优化用户体验（延迟显示、错误提示）


## 语音识别历史记录

### 数据库设计
- [x] 创建语音识别历史表
- [x] 存储音频文件URL
- [x] 存储转录文本和元数据

### 后端API
- [x] 创建识别历史CRUD API
- [x] 音频文件上传到S3
- [x] 支持搜索和筛选

### 前端界面
- [x] 创建历史记录管理页面
- [x] 列表展示和分页
- [x] 音频播放和文本编辑
- [x] 搜索和筛选功能

## 多语言自动检测

- [x] 集成语言检测API
- [x] 实时识别中自动检测语言
- [x] 自动切换到对应语言模型
- [x] 显示检测到的语言

## 语音命令控制

- [x] 定义语音命令词汇表（22个命令）
- [x] 实现命令解析引擎（Levenshtein距离算法）
- [x] 集成到编辑器操作（自定义事件系统）
- [x] 支持保存、新建、插入等命令（14个编辑器命令）
- [x] 命令反馈和确认（实时反馈UI组件）

## AI生成自动同步

- [x] AI生成时自动提取故事线事件
- [x] 自动更新可视化故事线图谱
- [x] 自动创建/更新工作区文件
- [x] 同步角色、设定等信息
- [x] 提供同步状态反馈

## 前端样式修复

- [x] 修复布局挤压问题
- [x] 优化响应式设计
- [x] 调整间距和边距
- [x] 确保各组件正常显示


## AI内容分析器完善

- [x] 集成真实AI模型调用
- [x] 实现自动文本信息提取
- [x] 支持故事线事件提取
- [x] 支持角色信息提取
- [x] 支持世界观设定提取
- [x] 优化提示词工程
- [x] 添加错误处理和重试机制


## 自定义提取规则

### 数据库设计
- [x] 创建extraction_rules表
- [x] 支持规则名称、描述、提取字段定义
- [x] 支持规则激活状态和优先级

### 后端API
- [x] 实现规则CRUD API
- [x] 规则模板预设功能
- [x] 规则验证和测试接口

### AI分析器集成
- [x] 动态加载用户自定义规则
- [x] 根据规则生成提示词
- [x] 支持多规则组合应用

### 前端界面
- [x] 创建规则配置管理页面
- [x] 规则编辑器（字段定义、示例）
- [x] 规则测试和预览功能
- [x] 规则模板库


## TypeScript类型错误修复
- [x] 修夏platformRulesDb.ts中的Drizzle ORM枚举类型错误
- [x] 使用正确的SQL函数或类型转换
- [x] 确保代码类型安全

## AI提示词优化
- [x] 优化故事线事件提取提示词
- [x] 优化角色信息提取提示词
- [x] 优化世界观设定提取提示词
- [x] 添加更多文本元素识别支持

## 规则模板库扩展
- [x] 添加情节转折点提取模板
- [x] 添加对话分析模板
- [x] 添加场景描写模板
- [x] 添加情感分析模板
- [x] 支持模板导入导出

## 规则配置前端页面
- [x] 创建规则列表页面
- [x] 实现规则编辑器
- [x] 字段定义可视化编辑
- [x] 规则测试和预览功能
- [x] 模板库浏览和应用

## 规则效果分析
- [x] 创建规则使用统计表
- [x] 记录规则使用次数和成功率
- [x] 实现效果分析API
- [x] 创建效果分析前端页面

## AI分析性能优化
- [x] 实现分析结果缓存机制
- [x] 使用内容哈希作为缓存键
- [x] 设置缓存过期时间
- [x] 优化API调用成本

## 语音命令控制系统
- [x] 设计命令词汇表
- [x] 实现NLP命令解析引擎
- [x] 集成到语音识别流程
- [x] 支持编辑器操作控制
- [x] 支持文档管理命令


## 语音命令前端集成（新增）

### 前端UI组件
- [x] 创建VoiceCommandFeedback反馈UI组件
- [x] 实现useVoiceCommandFeedback Hook
- [x] 支持四种状态显示（listening、processing、success、error）
- [x] 显示命令匹配置信度

### 集成服务
- [x] 创建voiceCommandIntegration集成服务
- [x] 实现processVoiceCommandFromTranscript函数
- [x] 实现containsVoiceCommand检测函数
- [x] 实现extractCommandParameters参数提取函数
- [x] 实现getAvailableVoiceCommands命令列表函数

### 编辑器命令执行
- [x] 创建editorCommandExecutor命令执行器
- [x] 实现14个编辑器命令（save、new-chapter、new-character等）
- [x] 实现mapCommandNameToEditorCommand命令映射
- [x] 通过自定义事件与编辑器通信
- [x] 支持命令参数传递和提取

### 增强的语音录制组件
- [x] 创建StreamingVoiceRecorderWithCommands组件
- [x] 集成命令识别和自动执行
- [x] 实时波形可视化（命令模式显示紫色）
- [x] 自动检测和处理语音命令
- [x] 提供详细的用户反馈

### 帮助和文档
- [x] 创建VoiceCommandHelp帮助页面
- [x] 完整的命令参考文档
- [x] 14个命令分类展示
- [x] 搜索和筛选功能
- [x] 最佳实践和常见问题

### 单元测试
- [x] 创建voiceCommandIntegration.test.ts
- [x] 测试命令检测（中文、英文、大小写）
- [x] 测试参数提取（count、type、position）
- [x] 创建editorCommandExecutor.test.ts
- [x] 测试命令映射
- [x] 测试所有14个命令执行

## 项目完成状态总结

### 已完成的主要功能模块
- [x] 项目管理和编辑系统
- [x] AI辅助创作（生成、续写、优化）
- [x] 可视化故事线图谱
- [x] 多平台发布（起点、晋江）
- [x] 语音朗读和识别
- [x] 语音命令控制（新增）
- [x] 内容分析和自定义规则
- [x] 任务队列和监控
- [x] 敏感词库管理
- [x] 平台规则配置

### 项目状态
✅ 所有TODO任务已完成，项目已达到生产就绪状态
